<div id="login-screen" class="fixed inset-0 flex flex-col items-center justify-start p-6 bg-slate-950 overflow-y-auto z-[500]">
    <div class="w-full max-w-md pt-12 space-y-10 animate-up">
      <div class="text-center">
        <h1 class="text-4xl font-extrabold tracking-tight italic text-yellow-500">PLATE<span class="text-white">COLLECTOR</span></h1>
        <p class="text-slate-500 text-[9px] font-bold uppercase tracking-[0.4em] mt-2">The Family Challenge 2026</p>
      </div>

      <div class="glass-card rounded-[3rem] p-8 space-y-6 shadow-2xl border-white/5">
        <p class="text-center text-xs font-black text-slate-400 uppercase tracking-widest">Selecciona tu perfil</p>
        
        <div id="profiles-container" class="grid grid-cols-1 gap-4">
          </div>

        <button onclick="openAddPlayerModal()" class="w-full py-4 border-2 border-dashed border-slate-700 rounded-3xl text-slate-500 font-bold hover:border-yellow-500/50 hover:text-yellow-500 transition-all flex items-center justify-center gap-2">
          <i class="fas fa-plus-circle"></i> NUEVO JUGADOR
        </button>
      </div>
    </div>
  </div>

  <div id="add-player-modal" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[600] hidden flex items-center justify-center p-6">
    <div class="glass-card w-full max-w-sm rounded-[3rem] p-8 space-y-6 border-yellow-500/20">
      <h3 class="text-2xl font-black italic text-center">NUEVO RIVAL</h3>
      <div class="space-y-4">
        <input id="new-player-name" type="text" placeholder="NOMBRE" class="w-full bg-slate-900 border border-white/10 rounded-2xl p-4 text-center font-black uppercase tracking-widest focus:border-yellow-500 outline-none">
        <input id="new-player-emoji" type="text" placeholder="EMOJI (ej: ðŸŽï¸)" class="w-full bg-slate-900 border border-white/10 rounded-2xl p-4 text-center text-2xl focus:border-yellow-500 outline-none">
      </div>
      <div class="flex gap-3">
        <button onclick="closeAddPlayerModal()" class="flex-1 py-4 rounded-2xl font-bold bg-slate-800">CANCELAR</button>
        <button onclick="saveNewPlayer()" class="flex-1 py-4 rounded-2xl font-bold bg-yellow-500 text-black">CREAR</button>
      </div>
    </div>
  </div>

<script>
    // --- NUEVA LÃ“GICA DE JUGADORES ---

    // Lista inicial si la base de datos estÃ¡ vacÃ­a
    let defaultPlayers = [
        { name: 'NOA', emoji: 'ðŸš™', color: 'blue' },
        { name: 'ERIK', emoji: 'ðŸŽï¸', color: 'purple' },
        { name: 'FER', emoji: 'ðŸš—', color: 'red' }
    ];

    // Escuchar cambios en la lista de jugadores de Firebase
    function listenToPlayers() {
      db.ref('users').on('value', (snap) => {
        const users = snap.val();
        const container = document.getElementById('profiles-container');
        container.innerHTML = "";
        
        // Si no hay usuarios en Firebase, usamos los default y los guardamos
        const playersToRender = users ? Object.values(users) : defaultPlayers;
        
        playersToRender.forEach(user => {
          const btn = document.createElement('button');
          btn.onclick = () => handleLoginRequest(user.name, user.emoji);
          btn.className = `neo-btn bg-slate-500/10 p-5 rounded-3xl flex items-center justify-between border border-white/5`;
          btn.innerHTML = `
            <div class="flex items-center gap-4">
              <div class="w-14 h-14 rounded-full bg-slate-800 flex items-center justify-center text-2xl shadow-lg border-2 border-white/10">${user.emoji}</div>
              <span class="text-2xl font-black italic uppercase">${user.name}</span>
            </div>
            <i class="fas fa-chevron-right text-slate-700"></i>
          `;
          container.appendChild(btn);
        });
      });
    }

    // Funciones del Modal
    function openAddPlayerModal() { document.getElementById('add-player-modal').classList.remove('hidden'); }
    function closeAddPlayerModal() { document.getElementById('add-player-modal').classList.add('hidden'); }

    function saveNewPlayer() {
      const name = document.getElementById('new-player-name').value.trim().toUpperCase();
      const emoji = document.getElementById('new-player-emoji').value.trim() || 'ðŸš€';
      
      if(name.length < 2) return showToast("NOMBRE MUY CORTO", "bg-red-500");

      db.ref('users/' + name).set({ name, emoji }).then(() => {
        document.getElementById('new-player-name').value = "";
        document.getElementById('new-player-emoji').value = "";
        closeAddPlayerModal();
        showToast("Â¡BIENVENIDO, " + name + "!", "bg-green-600");
      });
    }

    // Ajustamos handleLoginRequest para aceptar el emoji dinÃ¡mico
    function handleLoginRequest(name, emoji) {
      currentUser = name.toUpperCase();
      currentAvatar = emoji;
      confirmLogin();
    }

    // Actualizamos el onload para incluir la escucha de jugadores
    const originalOnload = window.onload;
    window.onload = () => {
      originalOnload();
      listenToPlayers();
    };
</script>
